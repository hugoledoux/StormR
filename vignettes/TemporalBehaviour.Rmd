---
title: "temporalBehaviour"
output: html_document
date: "2023-03-03"
---

``` {r}
library(StormR)
```

The `temporalBehaviour` function allows computing wind speed and direction for a given location or set of locations along the lifespan of a tropical cyclone. It also allows to compute the associated power dissipation index and the duration of exposure to winds reaching defined speed thresholds.  

### Computing and plotting time series of wind speed and direction

In the following example we compute and plot time series of the speed and direction of winds generated by the topical cyclone Pam (2015) in two of the main cities of Vanuatu, Port Vila (longitude = 168.33, latitude = -17.73) and Luganville (longitude = 167.17, latitude = -15.53).

``` {r}
df<-data.frame(x=c(168.33,167.17),y=c(-17.73,-15.53))
rownames(df)<-c("Port_Vila","Luganville")
st<-Storms(loi = "Vanuatu", names = "PAM", verbose=0)
plotStorms(st,reset_setting=FALSE)
points(df$x,df$y,pch=3,col=c("blue","red"))
text(df$x,df$y,labels = c("Port Vila","Luganville"),pos=2,col=c("blue","red"))
```

By default the temporal resolution of the `temporalBehaviour` function is 1 hour but can be changed using the `temp_res` argument. Here we set the temporal resolution to 30 min with `temp_res=0.5`. Time series are computed using the `product = "TS"` argument as follows:

``` {r}
TS<-temporalBehaviour(st, points = df, product = "TS",temp_res=0.5)
#TS$PAM$Port_Vila<-TS$PAM$Port_Vila[complete.cases(TS$PAM$Port_Vila),]
#TS$PAM$Luganville<-TS$PAM$Luganville[complete.cases(TS$PAM$Luganville),]
```

With the above specification the the `temporalBehaviour` function returns a list of two data frames (i.e., one for each location) with the wind speed ("speed"), direction ("direction"), ID of the observations ("indices", interpolated observations are noted with a decimal), and the date and time of the observation ("isoTimes").

``` {r}
str(TS)
```

We use the data frame to draw time series plots for wind speed and wind direction as follows:

``` {r}
par(mar=c(10,4,4,2))
plot(TS$PAM$Port_Vila$speed,type="l",ylim=c(0,60),xlab="",ylab="Wind speed (m/s)",axes=FALSE,col="blue")
points(TS$PAM$Port_Vila$speed,col="blue",pch=3)
lines(TS$PAM$Luganville$speed,col="red")
points(TS$PAM$Luganville$speed,col="red",pch=3)
legend("topleft",pch=3,col=c("blue","red"),legend=c("Port Vila","Luganville"),bty="n")
axis(1,at=seq(1,length(TS$PAM$Port_Vila$speed)),labels=TS$PAM$Port_Vila$isoTimes,las=2)
axis(2,at=seq(0,60,10),labels=seq(0,60,10),las=2)
dev.off()
```

``` {r}
par(mar=c(10,4,4,2))
plot(TS$PAM$Port_Vila$direction,type="l",ylim=c(0,360),xlab="",ylab="Wind direction (degree north)",axes=FALSE,col="blue")
points(TS$PAM$Port_Vila$direction,col="blue",pch=3)
lines(TS$PAM$Luganville$direction,col="red")
points(TS$PAM$Luganville$direction,col="red",pch=3)
legend("topleft",pch=3,col=c("blue","red"),legend=c("Port Vila","Luganville"),bty="n")
axis(1,at=seq(1,length(TS$PAM$Port_Vila$speed)),labels=TS$PAM$Port_Vila$isoTimes,las=2)
axis(2,at=seq(0,360,90),labels=seq(0,360,90),las=2)
dev.off()
```

Maximum sustained wind speed for Port Vila and Luganville can be computed as follows:

``` {r}
max(TS$PAM$Port_Vila$speed)
max(TS$PAM$Luganville$speed)
```

### Getting power dissipation index

The power dissipation index is computed using the `product = "PDI"` argument as follows:

``` {r}
PDI <- temporalBehaviour(st, points = df, product = "PDI", temp_res=0.5,)
PDI
```

### Getting duration of exposure

The duration of exposure is computed using the `product = "Exposure"` argument as follows:

``` {r}
exposure_SS <- temporalBehaviour(st, points = df, product = "Exposure", temp_res=0.5,)
exposure_SS
```

By default, the function returns the duration of exposure (in hours) to wind speeds above the thresholds used by the Saffir-Simpson hurricane wind scale (i.e., 18, 33, 42, 49, 58, and 70 $m.s^{-1}$, Simpson, 1974). However, different thresholds can be set using the `wind_threshold` arguments. For instance, we can use the thresholds used by the Australian Bureau of Meteorology to rank tropical cyclones intensity as follow:

``` {r}
wt <- c(17.2,24.4,32.5,44.2,55.0)
exposure_BOM<- temporalBehaviour(st, points = df, product = "Exposure", temp_res=0.5, wind_threshold=wt)
exposure_BOM
```

## References
* Simpson, R. H. (1974). The hurricane disaster potential scale. Weatherwise, 27, 169â€“186.

