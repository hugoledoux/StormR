---
title: "DataSource"
output: rmarkdown::pdf_document
date: "2023-03-03"
---



```{r step up, include = FALSE}
#library(StormR)
```



To run StormR functions users have to provide a tropical cyclone storm track dataset in which the location and some characteristics of storms are given across their lifespan.


## Data sources
To run StormR functions users have to provide a tropical cyclone storm track
dataset in which the location and some characteristics of storms are given
across their lifespan. This dataset must be contained in a netcdf file.We higlhy
recommand using IBTrACS databases as they provide the most extensive and
relevant data overall. Nevertheless, other databases can be used as long as the
following fields are provided:

| **Field name** | **Description** | **Format/Units** | **Example** | **Type** |
|:--:|:----:|:-----------:|:-----:|:--:|
| `basin` | Name of the area where the storm originated. Traditionally divided into seven basins | IBTRaCS format \newline NA (North Atlantic) \newline EP (Eastern North Pacific) \newline WP (Western North Pacific) \newline NI (North Indian) \newline SI (South Indian) \newline SP (Southern Pacific) \newline SA (South Atlantic)| SP | Mandatory |
| `names` | Names of the storms | Capital letters | PAM | Mandatory |
| `seasons` | Years of observations | Calendar year | 2015 | Mandatory |
| `isoTime` | Date and time of observations | YYYY-MM-DD HH:mm:ss UTC | 2015-03-13 12:00:00 | Mandatory |
| `lon` | Longitude of the observations | Eastern Decimal degrees | 168.7 | Mandatory |
| `lat` | Latitude of the observations | Northern Decimal degrees | -17.6 | Mandatory |
| `msw` | Maximum sustained wind speed | $m.s^{-1}$ | 77 | Mandatory |
| `rmw` | Radius of maximum winds: distance between the center of the storm and its band of strongest winds | $km$ | 20 | Recommended |
| `pressure` | Central pressure | $pa$ | 91100 | Recommended |
| `poci` | Pressure of the last closed isobar | $pa$ | 92200 | Recommended |
| `sshs` | Saffir-Simpson hurricane wind scale rating based on `msw` (here in $m.s^{-1}$) | $-1 =$ Tropical depression (`msw` $< 18$) \newline $0 =$ Tropical storm ($18 \leq$ `msw` $< 33$) \newline $1 =$ Category 1 ($33  \leq$ `msw` $< 42$) \newline $2 =$ Category 2 ($42 \leq$ `msw` $< 49$) \newline $3 =$ Category 3 ($49 \leq$ `msw` $< 58$) \newline $4 =$ Category 4 ($58 \leq$ `msw` $< 70$) \newline $5 =$ Category 5 (`msw` $\ge 70$)| 5 | Optional |

### Unit conversion
It is important to pay attention to the formats and units of data provided by the database.
If `msw`, `rmw`, `pressure` and/or `poci` fields units do not match the required units (Cf Format/Units column), 
a conversion will have to be performed during the extraction of data (See Define a StormsDataset section).

## Download a Data Source

\textbf{- Lien vers page téléchargement IBTraCKS OKKK}
\textbf{- Lien vers page téléchargement autre BDD ???}
\textbf{- Code pour download OKKK}


In the following example, we will use the data from the IBTrACS that gather all storms that occured in the 
South Pacific Basin (IBTrACS.SP.v04r00.nc). It is possible to download this file using:
```{r chunk, eval=FALSE}
download.file(url = "https://www.ncei.noaa.gov/data/international-best-track-archive-for-climate-stewardship-ibtracs/v04r00/access/netcdf/IBTrACS.SP.v04r00.nc",
              destfile = "./test_ibtracs.nc")

```


## Define a StormsDataset 
\textbf{- iniDataBase sur les 2 BDD téléchargées}
\textbf{- différence de gestion IBTRACKS car paramètres par défaut vs autre bdd ou il faut redéfinir les champs.}
\textbf{- dire qu'on a déjà une BDD par défaut de test déjà existant (e.g. ?IBTRACKS\_SP), pas besoin de faire un initDatabase OKKKK}
\textbf{- Gestion des unités ? OKKKKKK}

The `defDatabase` function let the user define a new dataset. This function returns a `StormsDataset` object,
especially designed to store all the informations needed for the dataset (See Data sources section).

In what follows, we define a new `StormsDataset` based on the database we downloaded right above and the default settings of `defDatabase` function.
```{r chunk2, eval = FALSE}

sds <- defDatabase(filename = "./test_ibtracs.nc",
                   fields = c(basin = "basin",
                              names = "name",
                              seasons = "season",
                              isoTime = "iso_time",
                              lon = "usa_lon",
                              lat = "usa_lat",
                              msw = "usa_wind",
                              sshs = "usa_sshs",
                              rmw = "usa_rmw",
                              pressure = "usa_pres",
                              poci = "usa_poci"),
                   basin = "SP",
                   seasons = c(1980, as.numeric(format(Sys.time(), "%Y"))),
                   unit_conversion = c(msw = "knt_to_ms",
                                       rmw = "nm_to_km",
                                       pressure = "mb_to_pa",
                                       poci = "mb_to_pa"),
                   verbose = TRUE)

```

Note:
If one is extracting data from IBTrACS databases, we strongly advise using the `usa_` fields as they are
the most filled and relevant.
The field `basin` here, will allow searching for storms that occured only in the South Pacific Basin.
The field `seasons` here, will allow searching for storms that occured between 1980 and the current year.


### Unit conversion
 
 In this example, IBRTrACS database provides maximum sustained wind (`msw`) in knots, radius of maximum wind (`rmw`) in nautical miles, pressure (`pressure`) and pressure at the outermost closed isobar (`poci`) in millibar. The `unit_conversion` argument is then used to precise how to convert units in the database. Here is a list of allowed arguments:

For `msw`: \newline
`knt_to_ms`: converts knot in meter per second  \newline
`kmh_to_ms`: converts kilometer per hour in meter per second \newline
`mph_to_ms`: converts miles per hour in meter per second \newline
`None`: No conversion needed \newline


For `rmw`: \newline
`nm_to_ms`: converts nautical miles in kilometer \newline
`None`: No conversion needed \newline


For both `pressure` and `poci`: \newline
`b_to_pa`: converts bar in pascal \newline
`mb_to_pa`: converts millibar in pascal \newline
`atm_to_pa`: converts atmosphere in pascal \newline
`psi_to_pa`: converts psi in pascal \newline
`None`: No conversion needed \newline


These fields in `unit_conversion` input are mandatory if they are also contain in the fields of `fields` input. If a field does not required any conversion, the user must still specify `"None"`.

### Dataset example

This package provides a dataset `test_dataset` which gathers all the tropical
cyclones that occured
nearby Vanuatu (resp. New Caledonia) from 2015 to 2016 (resp. 2020 to 2021 ). It represents the default
`StormsDataset` object used in the `Storms` function if non other `StormsDataset` object has been initialized 
with the `defDatabase` function.



## Visualisation du contenu du StormDataset 


\textbf{2-3 exemple :}
\textbf{- Structure de l'objet}
\textbf{- liste des noims disponibles dans la BDD}

```
str(StormTestVanuatu)
unique(StormTestVanuatu@database$names))
```


## Reference
 * Knapp, K. R., Kruk, M. C., Levinson, D. H., Diamond, H. J., & Neumann, C. J. (2010). The International Best Track Archive for Climate Stewardship (IBTrACS). Bulletin of the American Meteorological Society, 91(3), Article 3. https://doi.org/10.1175/2009bams2755.1
